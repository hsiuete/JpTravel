<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>XAMPP Test - JpTravel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <h1>XAMPP ç’°å¢ƒæ¸¬è©¦</h1>
    
    <div class="test-section info">
        <h3>æª”æ¡ˆæª¢æŸ¥</h3>
        <div id="file-check">æª¢æŸ¥ä¸­...</div>
    </div>
    
    <div class="test-section info">
        <h3>JSON æ ¼å¼æ¸¬è©¦</h3>
        <div id="json-test">æ¸¬è©¦ä¸­...</div>
    </div>
    
    <div class="test-section info">
        <h3>åœ°åœ–è¼‰å…¥æ¸¬è©¦</h3>
        <div id="map-test">æ¸¬è©¦ä¸­...</div>
    </div>

    <script>
        // æª”æ¡ˆæª¢æŸ¥
        async function checkFiles() {
            const fileCheck = document.getElementById('file-check');
            const files = ['index.html', 'map.js', 'itinerary.json'];
            let allExist = true;
            
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        fileCheck.innerHTML += `<p>âœ… ${file} - å­˜åœ¨ä¸”å¯å­˜å–</p>`;
                    } else {
                        fileCheck.innerHTML += `<p>âŒ ${file} - HTTP ${response.status}</p>`;
                        allExist = false;
                    }
                } catch (error) {
                    fileCheck.innerHTML += `<p>âŒ ${file} - ç„¡æ³•å­˜å–: ${error.message}</p>`;
                    allExist = false;
                }
            }
            
            if (allExist) {
                fileCheck.parentElement.className = 'test-section success';
            } else {
                fileCheck.parentElement.className = 'test-section error';
            }
        }

        // JSON æ ¼å¼æ¸¬è©¦
        async function testJSON() {
            const jsonTest = document.getElementById('json-test');
            try {
                const response = await fetch('itinerary.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                // æª¢æŸ¥å¿…è¦æ¬„ä½
                const requiredFields = ['trip', 'from', 'start_date', 'end_date', 'days'];
                const missingFields = requiredFields.filter(field => !data[field]);
                
                if (missingFields.length > 0) {
                    throw new Error(`ç¼ºå°‘å¿…è¦æ¬„ä½: ${missingFields.join(', ')}`);
                }
                
                if (!Array.isArray(data.days) || data.days.length === 0) {
                    throw new Error('days é™£åˆ—ç‚ºç©ºæˆ–æ ¼å¼éŒ¯èª¤');
                }
                
                // æª¢æŸ¥æ¯å€‹åœ°é»æ˜¯å¦æœ‰å¿…è¦æ¬„ä½
                let placeErrors = 0;
                data.days.forEach((day, dayIndex) => {
                    if (!Array.isArray(day.places)) {
                        placeErrors++;
                        return;
                    }
                    
                    day.places.forEach((place, placeIndex) => {
                        if (!place.name || !place.lat || !place.lng) {
                            placeErrors++;
                        }
                    });
                });
                
                if (placeErrors > 0) {
                    throw new Error(`${placeErrors} å€‹åœ°é»ç¼ºå°‘å¿…è¦æ¬„ä½ (name, lat, lng)`);
                }
                
                jsonTest.innerHTML = `
                    <p>âœ… JSON æ ¼å¼æ­£ç¢º</p>
                    <p>ğŸ“Š çµ±è¨ˆè³‡è¨Š:</p>
                    <ul>
                        <li>è¡Œç¨‹: ${data.trip}</li>
                        <li>å‡ºç™¼åœ°: ${data.from}</li>
                        <li>æ—¥æœŸ: ${data.start_date} â†’ ${data.end_date}</li>
                        <li>å¤©æ•¸: ${data.days.length} å¤©</li>
                        <li>ç¸½åœ°é»æ•¸: ${data.days.reduce((sum, day) => sum + day.places.length, 0)} å€‹</li>
                    </ul>
                `;
                jsonTest.parentElement.className = 'test-section success';
                
            } catch (error) {
                jsonTest.innerHTML = `<p>âŒ JSON éŒ¯èª¤: ${error.message}</p>`;
                jsonTest.parentElement.className = 'test-section error';
            }
        }

        // åœ°åœ–è¼‰å…¥æ¸¬è©¦
        async function testMap() {
            const mapTest = document.getElementById('map-test');
            try {
                // æª¢æŸ¥ Leaflet æ˜¯å¦å¯ç”¨
                if (typeof L === 'undefined') {
                    throw new Error('Leaflet æœªè¼‰å…¥');
                }
                
                // æª¢æŸ¥åœ°åœ–å®¹å™¨
                const mapContainer = document.createElement('div');
                mapContainer.style.width = '100px';
                mapContainer.style.height = '100px';
                document.body.appendChild(mapContainer);
                
                const map = L.map(mapContainer).setView([35.68, 139.75], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(map);
                
                document.body.removeChild(mapContainer);
                
                mapTest.innerHTML = `
                    <p>âœ… Leaflet åœ°åœ–è¼‰å…¥æˆåŠŸ</p>
                    <p>âœ… åœ°åœ–åœ–å±¤è¼‰å…¥æˆåŠŸ</p>
                    <p>âœ… åœ°åœ–åˆå§‹åŒ–æˆåŠŸ</p>
                `;
                mapTest.parentElement.className = 'test-section success';
                
            } catch (error) {
                mapTest.innerHTML = `<p>âŒ åœ°åœ–è¼‰å…¥å¤±æ•—: ${error.message}</p>`;
                mapTest.parentElement.className = 'test-section error';
            }
        }

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        window.addEventListener('load', async () => {
            await checkFiles();
            await testJSON();
            await testMap();
        });
    </script>
</body>
</html>
